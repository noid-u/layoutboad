<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>レイアウトボード</title>
<link rel="stylesheet" href="layout.css">
</head>
<body>
  <header>
    <!-- ファイル -->
    <div class="group" title="エクスポート/インポート/画像保存">
      <span class="group-label">ファイル</span>
      <button class="btn" id="btnNew">新規</button>
      <button class="btn" id="btnExport">エクスポート</button>
      <button class="btn" id="btnImport">インポート</button>
      <button class="btn" id="btnExportImage">画像保存</button>
      <dialog id="dlgImport">
        <p style="margin:0 0 6px">JSONファイルを選択</p>
        <input id="importFile" type="file" accept="application/json,.json">
        <div style="display:flex;gap:6px;justify-content:flex-end;margin-top:8px">
          <button class="btn btn-primary" id="importDo">読み込む</button>
          <button class="btn" id="importCancel">閉じる</button>
        </div>
      </dialog>
      <dialog id="dlgImage">
        <p style="margin:0 0 8px">画像形式を選択</p>
        <div style="display:flex;gap:8px">
          <button class="btn" id="savePNG">PNGで保存</button>
          <div>
            <button class="btn" id="saveJPEG">JPEGで保存</button>
            <div style="font-size:12px;color:#64748b;margin-top:4px">品質 <input id="jpegQ" type="range" min="0.5" max="0.95" step="0.05" value="0.9"></div>
          </div>
        </div>
        <div style="display:flex;justify-content:flex-end;margin-top:10px">
          <button class="btn" id="imgCancel">閉じる</button>
        </div>
      </dialog>
    </div>

    <!-- 編集 -->
    <div class="group" title="編集操作">
      <span class="group-label">編集</span>
      <button class="btn" id="btnCopy" title="Ctrl+C">コピー</button>
      <button class="btn" id="btnCut" title="Ctrl+X">切り取り</button>
      <button class="btn" id="btnPaste" title="Ctrl+V">貼り付け</button>
      <button class="btn btn-danger" id="btnDelete" title="Deleteで同じ">選択削除</button>
      <button class="btn" id="btnUndo" title="Ctrl+Z / ⌘Z">元に戻す</button>
      <button class="btn" id="btnRedo" title="Ctrl+Y / ⌘Shift+Z">やり直し</button>
    </div>

    <!-- 表示 -->
    <div class="group" title="表示/ズーム/グリッド">
      <span class="group-label">表示</span>
      <button class="btn" id="zoomOut">－</button>
      <button class="btn" id="zoomReset">100%</button>
      <button class="btn" id="zoomIn">＋</button>
      <span id="zoomLabel" style="font-size:12px;color:#475569;margin-left:2px;">100%</span>
      <label style="margin-left:10px"><input type="checkbox" id="gridToggle" checked> グリッド表示</label>
      <label style="margin-left:6px"><input type="checkbox" id="snap" checked> スナップ</label>
      <label style="margin-left:6px">グリッド<span id="gridSizeLabel">20</span>px</label>
      <input id="gridSize" type="range" min="10" max="80" step="2" value="20" style="width:120px">
    </div>

    <!-- 重なり -->
    <div class="group" title="重なり順">
      <span class="group-label">重なり</span>
      <button class="btn" id="zBackMost">最背面</button>
      <button class="btn" id="zBack">背面へ</button>
      <button class="btn" id="zFront">前面へ</button>
      <button class="btn" id="zFrontMost">最前面</button>
    </div>

    <!-- 接続 -->
    <div class="group" title="図形同士を線で接続">
      <span class="group-label">接続</span>
      <button class="btn" id="btnConnect">接続モード</button>
      <span id="connectHint" style="font-size:12px;color:#64748b;display:none">ノードを2つクリックで接続</span>
    </div>
  </header>

  <div class="wrap">
    <aside class="palette">
      <h2>パレット（ドラッグで配置／クリックで追加）</h2>
      <div id="paletteItems" aria-label="基本図形とオブジェクト">
        <div class="group-title">基本図形</div>
        <div class="items shapes">
          <!-- 基本図形（アイコン） -->
          <div class="item" draggable="true" data-type="rect" data-w="120" data-h="60" title="四角形">
            <svg viewBox="0 0 24 24" aria-hidden="true"><rect x="3" y="6" width="18" height="12" rx="3"/></svg>
          </div>
          <div class="item" draggable="true" data-type="triangle" data-w="100" data-h="80" title="三角形">
            <svg viewBox="0 0 24 24" aria-hidden="true"><polygon points="12,3 21,21 3,21"/></svg>
          </div>
          <div class="item" draggable="true" data-type="circle" data-w="80" data-h="80" title="円形">
            <svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="8"/></svg>
          </div>
          <div class="item" draggable="true" data-type="star" data-w="100" data-h="100" title="星形">
            <svg viewBox="0 0 24 24" aria-hidden="true"><polygon points="12,2 15,9 22,9 16.5,13 18.5,20 12,16 5.5,20 7.5,13 2,9 9,9"/></svg>
          </div>
        </div>

        <div class="group-title">オブジェクト</div>
        <div class="items objects">
          <div class="item text" draggable="true" data-type="desk" data-w="120" data-h="60">机</div>
          <div class="item text" draggable="true" data-type="chair" data-w="50" data-h="50">椅子</div>
          <div class="item text" draggable="true" data-type="pc" data-w="80" data-h="50">PC</div>
          <div class="item text" draggable="true" data-type="phone" data-w="80" data-h="50" data-text="電話">電話</div>
          <div class="item text" draggable="true" data-type="label" data-w="140" data-h="50" data-text="ラベル">ラベル</div>
        </div>
      </div>

      <div class="inspector">
        <div class="inspector-actions">
          <span class="spacer">選択中の要素を編集</span>
          <label><input type="checkbox" id="autoApply"> 自動適用</label>
          <button class="btn" id="resetStyle">既定に戻す</button>
          <button class="btn btn-primary" id="applyStyle">適用</button>
        </div>

        <label>背景色<input type="color" id="bgColor"></label>
        <label>背景の透明度(%)<input type="range" id="bgAlpha" min="0" max="100" value="100"></label>
        <label>文字色<input type="color" id="fgColor" value="#111111"></label>
        <label>文字サイズ(px)<input type="number" id="fontSize" min="8" max="60" step="1" value="14"></label>
        <label>角丸(px)<input type="number" id="radius" min="0" max="60" step="1" value="8"></label>

        <label>回転(°)<input type="number" id="rotateDeg" min="-180" max="180" step="1" value="0"></label>
        <label>文字方向
          <select id="textMode">
            <option value="auto">自動（常に水平）</option>
            <option value="h">横書き（回転に追従）</option>
            <option value="v">縦書き</option>
          </select>
        </label>

        <div class="full subtle">枠線</div>
        <label>線の太さ(px)<input type="number" id="borderW" min="0" max="20" step="1" value="1"></label>
        <label>線の色<input type="color" id="borderC" value="#cbd5e1"></label>
        <label>線の種類
          <select id="borderS">
            <option value="solid">実線</option>
            <option value="dashed">破線</option>
            <option value="dotted">点線</option>
            <option value="none">なし</option>
          </select>
        </label>

        <div class="full subtle">文字揃え</div>
        <label>水平揃え
          <select id="alignH">
            <option value="center">中央</option>
            <option value="left">左</option>
            <option value="right">右</option>
          </select>
        </label>
        <label>垂直揃え
          <select id="alignV">
            <option value="center">中央</option>
            <option value="top">上</option>
            <option value="bottom">下</option>
          </select>
        </label>

        <div class="full subtle">直線のみ</div>
        <label>線の太さ(直線)(px)<input type="number" id="lineThickness" min="1" max="40" step="1" value="2"></label>

        <div class="full subtle">コネクタ</div>
        <label>太さ(px)<input type="number" id="connStroke" min="1" max="20" step="1" value="2"></label>
        <label>色<input type="color" id="connColor" value="#64748b"></label>
        <label>始点
          <select id="connFrom">
            <option value="auto">自動</option>
            <option value="left">左</option>
            <option value="right">右</option>
            <option value="top">上</option>
            <option value="bottom">下</option>
          </select>
        </label>
        <label>終点
          <select id="connTo">
            <option value="auto">自動</option>
            <option value="left">左</option>
            <option value="right">右</option>
            <option value="top">上</option>
            <option value="bottom">下</option>
          </select>
        </label>
        <label><span>矢印（始点）</span><input type="checkbox" id="connArrowStart"></label>
        <label><span>矢印（終点）</span><input type="checkbox" id="connArrowEnd"></label>

        <div class="full footer">
          <div style="font-weight:600;">ヒント</div>
          <ul>
            <li><strong>テキスト：</strong>要素を<strong>ダブルクリック</strong> → 編集（Enterで改行／Ctrl+Enterで確定／Escでキャンセル）。</li>
            <li><strong>複製：</strong><kbd>Alt</kbd> + ドラッグ。</li>
            <li><strong>複数選択：</strong>ドラッグ範囲 or <kbd>Shift</kbd>+クリック。</li>
            <li><strong>履歴：</strong><kbd>Ctrl/Cmd+Z</kbd>／<kbd>Ctrl/Cmd+Y</kbd>。</li>
            <li><strong>接続：</strong>「接続モード」を押して、ノードを2つクリック。</li>
            <li><strong>コネクタ選択：</strong>線をクリック。<kbd>Delete</kbd>で削除。</li>
          </ul>
        </div>
      </div>
    </aside>

    <main class="stage-viewport" id="viewport">
      <div class="stage-wrap" id="stageWrap" style="transform:scale(1);">
        <div id="stage" tabindex="0" aria-label="作業エリア">
          <svg id="connLayer">
            <defs>
              <marker id="arrowHead" markerWidth="10" markerHeight="10" refX="10" refY="5" orient="auto">
                <path d="M0,0 L10,5 L0,10 Z" fill="currentColor"></path>
              </marker>
              <marker id="arrowTail" markerWidth="10" markerHeight="10" refX="0" refY="5" orient="auto">
                <path d="M10,0 L0,5 L10,10 Z" fill="currentColor"></path>
              </marker>
            </defs>
          </svg>
        </div>
        <div id="marquee" class="marquee"></div>
      </div>
    </main>
  </div>

  <div id="errorbar" class="errorbar"></div>

  <script src="layout.js"></script>
</body>
</html>
